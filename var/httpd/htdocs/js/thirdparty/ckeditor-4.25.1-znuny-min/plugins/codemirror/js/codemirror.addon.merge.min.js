!function(q){"object"==typeof exports&&"object"==typeof module?q(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","diff_match_patch"],q):q(CodeMirror)}(function(q){function E(a,b){this.mv=a;this.type=b;this.classes="left"==b?{chunk:"CodeMirror-merge-l-chunk",start:"CodeMirror-merge-l-chunk-start",end:"CodeMirror-merge-l-chunk-end",insert:"CodeMirror-merge-l-inserted",del:"CodeMirror-merge-l-deleted",connect:"CodeMirror-merge-l-connect"}:{chunk:"CodeMirror-merge-r-chunk",
start:"CodeMirror-merge-r-chunk-start",end:"CodeMirror-merge-r-chunk-end",insert:"CodeMirror-merge-r-inserted",del:"CodeMirror-merge-r-deleted",connect:"CodeMirror-merge-r-connect"}}function C(a){a.diffOutOfDate&&(a.diff=S(a.orig.getValue(),a.edit.getValue(),a.mv.options.ignoreWhitespace),a.chunks=T(a.diff),a.diffOutOfDate=!1,q.signal(a.edit,"updateDiff",a.diff))}function D(a,b){var c,e,g,f,h,d,k,n,m;if(!a.diffOutOfDate){a.needsScrollSync=null;if(!(c=!a.lockScroll)){c=+new Date;m=b?(d=a.edit,a.orig):
(d=a.orig,a.edit);if(d.state.scrollSetBy==a&&(d.state.scrollSetAt||0)+250>c)h=void 0;else{e=d.getScrollInfo();if("align"==a.mv.options.connect)h=e.top;else{g=.5*e.clientHeight;n=e.top+g;f=d.lineAtHeight(n,"local");for(var p=a.chunks,l,r,q,v,t=0;t<p.length;t++){var u=p[t],x=b?u.editFrom:u.origFrom,z=b?u.editTo:u.origTo;null==r&&(f<x?(r=u.editFrom,v=u.origFrom):f<z&&(r=u.editTo,v=u.origTo));z<=f?(l=u.editTo,q=u.origTo):x<=f&&(l=u.editFrom,q=u.origFrom)}f={edit:{before:l,after:r},orig:{before:q,after:v}};
d=U(d,b?f.edit:f.orig);f=U(m,b?f.orig:f.edit);n=(n-d.top)/(d.bot-d.top);(h=f.top-g+n*(f.bot-f.top))>e.top&&1>(k=e.top/g)?h=h*k+e.top*(1-k):(d=e.height-e.clientHeight-e.top)<g&&d<(n=m.getScrollInfo()).height-n.clientHeight-h&&1>(k=d/g)&&(h=h*k+(n.height-n.clientHeight-d)*(1-k))}h=(m.scrollTo(e.left,h),m.state.scrollSetAt=c,m.state.scrollSetBy=a,1)}c=h}return c}a.lockScroll&&null==a.needsScrollSync&&(a.needsScrollSync=b)}function U(a,b){var c=b.after;return null==c&&(c=a.lastLine()+1),{top:a.heightAtLine(b.before||
0,"local"),bot:a.heightAtLine(c,"local")}}function K(a,b,c){(a.lockScroll=b)&&0!=c&&D(a,DIFF_INSERT)&&B(a);(b?q.addClass:q.rmClass)(a.lockButton,"CodeMirror-merge-scrolllock-enabled")}function L(a,b,c){for(var e=0;e<b.length;++e){var g=b[e];if(g instanceof q.TextMarker)g.clear();else if(g.parent)for(var f=a,h=c,d=h.classLocation,k=0;k<d.length;k++)f.removeLineClass(g,d[k],h.chunk),f.removeLineClass(g,d[k],h.start),f.removeLineClass(g,d[k],h.end)}b.length=0}function V(a,b,c,e,g){var f=a.getViewport();
a.operation(function(){c.from==c.to||20<f.from-c.to||20<c.from-f.to?(L(a,c.marked,g),M(a,b,e,c.marked,f.from,f.to,g),c.from=f.from,c.to=f.to):(f.from<c.from&&(M(a,b,e,c.marked,f.from,c.from,g),c.from=f.from),f.to>c.to&&(M(a,b,e,c.marked,c.to,f.to,g),c.to=f.to))})}function N(a,b,c,e,g,f){var h=c.classLocation;b=a.getLineHandle(b);for(var d=0;d<h.length;d++)e&&a.addLineClass(b,h[d],c.chunk),g&&a.addLineClass(b,h[d],c.start),f&&a.addLineClass(b,h[d],c.end);return b}function M(a,b,c,e,g,f,h){function d(c,
b){for(var d=Math.max(g,c),l=Math.min(f,b),k=d;k<l;++k)e.push(N(a,k,h,!0,k==c,k==b-1));c==b&&d==b&&l==b&&(d?e.push(N(a,d-1,h,!1,!1,!0)):e.push(N(a,d,h,!1,!0,!1)))}for(var k=x(0,0),n=x(g,0),m=a.clipPos(x(f-1)),p=c==DIFF_DELETE?h.del:h.insert,l,r=0,q=!1,v=0;v<b.length;++v){var t,u,w,z=b[v],y=z[0],z=z[1];y==DIFF_EQUAL?(u=k.line+(W(b,v)?0:1),F(k,z),u<(t=k.line+(X(b,v)?1:0))&&(q&&(d(r,u),q=!1),r=t)):(q=!0,y==c&&(u=F(k,z,!0),t=k,z=0<((y=n).line-t.line||y.ch-t.ch)?y:t,y=u,w=0>((w=m).line-y.line||w.ch-y.ch)?
w:y,y=w,(l=z).line==y.line&&l.ch==y.ch||e.push(a.markText(z,w,{className:p})),k=u))}q&&d(r,k.line+1)}function B(a){if(a.showDifferences){a.svg&&(G(a.svg),b=a.gap.offsetWidth,Y(a.svg,"width",b,"height",a.gap.offsetHeight));a.copyButtons&&G(a.copyButtons);for(var b,c=a.edit.getViewport(),e=a.orig.getViewport(),g=a.mv.wrap.getBoundingClientRect().top,f=g-a.edit.getScrollerElement().getBoundingClientRect().top+a.edit.getScrollInfo().top,g=g-a.orig.getScrollerElement().getBoundingClientRect().top+a.orig.getScrollInfo().top,
h=0;h<a.chunks.length;h++){var d=a.chunks[h];if(d.editFrom<=c.to&&d.editTo>=c.from&&d.origFrom<=e.to&&d.origTo>=e.from){var k=n=p=m=void 0,n,m,k,p,l=a,r=g,q=f,v=b,t="left"==l.type,u=l.orig.heightAtLine(d.origFrom,"local",!0)-r;l.svg&&(m=u,p=l.edit.heightAtLine(d.editFrom,"local",!0)-q,t&&(n=m,m=p,p=n),r=l.orig.heightAtLine(d.origTo,"local",!0)-r,k=l.edit.heightAtLine(d.editTo,"local",!0)-q,t&&(n=r,r=k,k=n),t=" C "+v/2+" "+p+" "+v/2+" "+m+" "+(v+2)+" "+m,n=" C "+v/2+" "+r+" "+v/2+" "+k+" -1 "+k,Y(l.svg.appendChild(document.createElementNS("http://www.w3.org/2000/svg",
"path")),"d","M -1 "+p+t+" L "+(v+2)+" "+r+n+" z","class",l.classes.connect));l.copyButtons&&(m=l.copyButtons.appendChild(w("div","left"==l.type?"⇝":"⇜","CodeMirror-merge-copy")),k=l.mv.options.allowEditingOriginals,m.title=l.edit.phrase(k?"Push to left":"Revert chunk"),m.chunk=d,m.style.top=(d.origTo>d.origFrom?u:l.edit.heightAtLine(d.editFrom,"local")-q)+"px",m.setAttribute("role","button"),m.setAttribute("tabindex","0"),m.setAttribute("aria-label",m.title),k)&&(p=l.edit.heightAtLine(d.editFrom,
"local")-q,(t=l.copyButtons.appendChild(w("div","right"==l.type?"⇝":"⇜","CodeMirror-merge-copy-reverse"))).title="Push to right",t.chunk={editFrom:d.origFrom,editTo:d.origTo,origFrom:d.editFrom,origTo:d.editTo},t.style.top=p+"px","right"==l.type?t.style.left="2px":t.style.right="2px",t.setAttribute("role","button"),t.setAttribute("tabindex","0"),t.setAttribute("aria-label",t.title))}}}}function Z(a,b){for(var c=0,e=0,g=0;g<b.length;g++){var f=b[g];if(f.editTo>a&&f.editFrom<=a)return null;if(f.editFrom>
a)break;c=f.editTo;e=f.origTo}return e+(a-c)}function O(a,b,c){var e=a.state.trackAlignable;a=a.firstLine();for(var g=0,f=[],h=0;;h++){for(var d=b[h],k=d?c?d.origFrom:d.editFrom:1E9;g<e.alignable.length;g+=2){var n=e.alignable[g]+1;if(!(n<=a)){if(!(n<=k))break;f.push(n)}}if(!d)break;f.push(a=c?d.origTo:d.editTo)}return f}function aa(a,b,c,e){var g=0,f=0,h=0,d=0;a:for(;;g++){var k=a[g],n=b[f];if(!k&&null==n)break;for(var m=k?k[0]:1E9,p=null==n?1E9:n;h<c.length;){var l=c[h];if(l.origFrom<=p&&l.origTo>
p){f++;g--;continue a}if(l.editTo>m){if(l.editFrom<=m)continue a;break}d+=l.origTo-l.origFrom-(l.editTo-l.editFrom);h++}m==p-d?(k[e]=p,f++):m<p-d?k[e]=m+d:((n=[p-d,null,null])[e]=p,a.splice(g,0,n),f++)}}function P(a,b){if(a.dealigned||b){if(!a.orig.curOp)return a.orig.operation(function(){P(a,b)});a.dealigned=!1;for(var c=a.mv.left==a?a.mv.right:a.mv.left,e=(c&&(C(c),c.dealigned=!1),function(a,c){var b=O(a.edit,a.chunks,!1),e=[];if(c)for(var d=0,g=0;d<c.chunks.length;d++){for(var f=c.chunks[d].editTo;g<
b.length&&b[g]<f;)g++;g!=b.length&&b[g]==f||b.splice(g++,0,f)}for(d=0;d<b.length;d++)e.push([b[d],null,null]);return aa(e,O(a.orig,a.chunks,!0),a.chunks,1),c&&aa(e,O(c.orig,c.chunks,!0),c.chunks,2),e}(a,c)),g=a.mv.aligners,f=0;f<g.length;f++)g[f].clear();g.length=0;var h=[a.edit,a.orig],d=[],k=[];c&&h.push(c.orig);for(f=0;f<h.length;f++)d.push(h[f].getScrollInfo().top),k.push(-h[f].getScrollerElement().getBoundingClientRect().top);(k[0]!=k[1]||3==h.length&&k[1]!=k[2])&&ba(h,k,[0,0,0],g);for(c=0;c<
e.length;c++)ba(h,k,e[c],g);for(f=0;f<h.length;f++)h[f].scrollTo(null,d[f])}}function ba(a,b,c,e){for(var g,f=-1E8,h=[],d=0;d<a.length;d++)null!=c[d]&&(g=a[d].heightAtLine(c[d],"local")-b[d],h[d]=g,f=Math.max(f,g));for(var k,n,m,p,l,d=0;d<a.length;d++)null!=c[d]&&1<(m=f-h[d])&&e.push((k=a[d],n=c[d],p=!(l=p=void 0),n>k.lastLine()&&(n--,p=!1),(l=document.createElement("div")).className="CodeMirror-merge-spacer",l.style.height=m+"px",l.style.minWidth="1px",k.addLineWidget(n,l,{height:m,above:p,mergeSpacer:!0,
handleMouseEvents:!0})))}function ca(a,b,c,e){var g,f,h,d;a.diffOutOfDate||(g=e.origTo>c.lastLine()?x(e.origFrom-1):x(e.origFrom,0),f=x(e.origTo,0),h=e.editTo>b.lastLine()?x(e.editFrom-1):x(e.editFrom,0),e=x(e.editTo,0),(d=a.mv.options.revertChunk)?d(a.mv,c,g,f,b,h,e):b.replaceRange(c.getRange(g,f),h,e))}function da(a){var b,c=a.lockButton=w("div",null,"CodeMirror-merge-scrolllock"),e=(c.setAttribute("role","button"),c.setAttribute("tabindex","0"),w("div",[c],"CodeMirror-merge-scrolllock-wrap")),
c=(q.on(c,"click",function(){K(a,!a.lockScroll)}),q.on(c,"keyup",function(c){"Enter"!==c.key&&"Space"!==c.code||K(a,!a.lockScroll)}),[e]);return!1!==a.mv.options.revertButtons&&(a.copyButtons=w("div",null,"CodeMirror-merge-copybuttons-"+a.type),q.on(a.copyButtons,"click",b=function(c){c=c.target||c.srcElement;c.chunk&&("CodeMirror-merge-copy-reverse"==c.className?ca(a,a.orig,a.edit,c.chunk):ca(a,a.edit,a.orig,c.chunk))}),q.on(a.copyButtons,"keyup",function(a){"Enter"!==a.key&&"Space"!==a.code||b(a)}),
c.unshift(a.copyButtons)),"align"!=a.mv.options.connect&&((e=document.createElementNS&&document.createElementNS("http://www.w3.org/2000/svg","svg"))&&!e.createSVGRect&&(e=null),a.svg=e)&&c.push(e),a.gap=w("div",c,"CodeMirror-merge-gap")}function ea(a){return"string"==typeof a?a:a.getValue()}function S(a,b,c){a=(fa=fa||new diff_match_patch).diff_main(a,b);for(b=0;b<a.length;++b){var e=a[b];(c?/[^ \t]/.test(e[1]):e[1])?b&&a[b-1][0]==e[0]&&(a.splice(b--,1),a[b][1]+=e[1]):a.splice(b--,1)}return a}function T(a){var b=
[];if(a.length){for(var c=0,e=0,g=x(0,0),f=x(0,0),h=0;h<a.length;++h){var d,k,n,m,p=a[h],l=p[0];l==DIFF_EQUAL?(k=!W(a,h)||g.line<c||f.line<e?1:0,d=g.line+k,k=f.line+k,F(g,p[1],null,f),m=X(a,h)?1:0,n=g.line+m,m=f.line+m,d<n&&(h&&b.push({origFrom:e,origTo:k,editFrom:c,editTo:d}),c=n,e=m)):F(l==DIFF_INSERT?g:f,p[1])}(c<=g.line||e<=f.line)&&b.push({origFrom:e,origTo:f.line+1,editFrom:c,editTo:g.line+1})}return b}function X(a,b){var c;return b==a.length-1||!(1==(c=a[b+1][1]).length&&b<a.length-2||10!=
c.charCodeAt(0))&&(b==a.length-2||(1<(c=a[b+2][1]).length||b==a.length-3)&&10==c.charCodeAt(0))}function W(a,b){var c;return 0==b||10==(c=a[b-1][1]).charCodeAt(c.length-1)&&(1==b||10==(c=a[b-2][1]).charCodeAt(c.length-1))}function ga(a,b,c,e){for(var g=0;g<a.chunks.length;g++)for(var f=a.chunks[g],h=f.editFrom-b;h<f.editTo+b;h++){var d=h+c;0<=d&&d<e.length&&(e[d]=!1)}}function w(a,b,c,e){a=document.createElement(a);if(c&&(a.className=c),e&&(a.style.cssText=e),"string"==typeof b)a.appendChild(document.createTextNode(b));
else if(b)for(c=0;c<b.length;++c)a.appendChild(b[c]);return a}function G(a){for(var b=a.childNodes.length;0<b;--b)a.removeChild(a.firstChild)}function Y(a){for(var b=1;b<arguments.length;b+=2)a.setAttribute(arguments[b],arguments[b+1])}function Q(a,b){for(var c in b=b||{},a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function F(a,b,c,e){a=c?x(a.line,a.ch):a;for(c=0;;){var g=b.indexOf("\n",c);if(-1==g)break;++a.line;e&&++e.line;c=g+1}return a.ch=(c?0:a.ch)+(b.length-c),e&&(e.ch=(c?0:e.ch)+(b.length-
c)),a}function R(a){this.cm=a;this.alignable=[];this.height=a.doc.height;var b=this;a.on("markerAdded",function(a,e){e.collapsed&&null!=(e=e.find(1))&&b.set(e.line,H)});a.on("markerCleared",function(a,e,g,f){null!=f&&e.collapsed&&b.check(f,H,b.hasMarker)});a.on("markerChanged",this.signal.bind(this));a.on("lineWidgetAdded",function(a,e,g){e.mergeSpacer||(e.above?b.set(g-1,A):b.set(g,ha))});a.on("lineWidgetCleared",function(a,e,g){e.mergeSpacer||(e.above?b.check(g-1,A,b.hasWidgetBelow):b.check(g,ha,
b.hasWidget))});a.on("lineWidgetChanged",this.signal.bind(this));a.on("change",function(a,e){var g=e.from.line,f=e.to.line-e.from.line,h=e.text.length-1,d=g+h;(f||h)&&b.map(g,f,h);b.check(d,H,b.hasMarker);(f||h)&&b.check(e.from.line,H,b.hasMarker)});a.on("viewportChange",function(){b.cm.doc.height!=b.height&&b.signal()})}function ia(a,b){var c=null,e=a.state.diffViews,g=a.getCursor().line;if(e)for(var f=0;f<e.length;f++){var h=e[f],d=a==h.orig,h=(C(h),(0>b?function(a,c,b){for(var e=a.length-1;0<=
e;e--){var d=a[e],d=(b?d.origTo:d.editTo)-1;if(d<c)return d}}:function(a,c,b){for(var e=0;e<a.length;e++){var d=a[e],d=b?d.origFrom:d.editFrom;if(c<d)return d}})(h.chunks,g,d));null==h||null!=c&&!(0>b?c<h:h<c)||(c=h)}if(null==c)return q.Pass;a.setCursor(c,0)}var x=q.Pos,I=!(E.prototype={constructor:E,init:function(a,b,c){this.edit=this.mv.edit;(this.edit.state.diffViews||(this.edit.state.diffViews=[])).push(this);this.orig=q(a,Q({value:b,readOnly:!this.mv.options.allowEditingOriginals},Q(c)));"align"==
this.mv.options.connect&&(this.edit.state.trackAlignable||(this.edit.state.trackAlignable=new R(this.edit)),this.orig.state.trackAlignable=new R(this.orig));this.lockButton.title=this.edit.phrase("Toggle locked scrolling");this.lockButton.setAttribute("aria-label",this.lockButton.title);this.orig.state.diffViews=[this];a=c.chunkClassLocation||"background";"[object Array]"!=Object.prototype.toString.call(a)&&(a=[a]);this.classes.classLocation=a;this.diff=S(ea(b),ea(c.value),this.mv.options.ignoreWhitespace);
this.chunks=T(this.diff);this.diffOutOfDate=this.dealigned=!1;this.needsScrollSync=null;this.showDifferences=!1!==c.showDifferences},registerEvents:function(a){var b;this.forceUpdate=function(a){function b(d){p=!(I=!0);"full"==d&&(a.svg&&G(a.svg),a.copyButtons&&G(a.copyButtons),L(a.edit,n.marked,a.classes),L(a.orig,m.marked,a.classes),n.from=n.to=m.from=m.to=0);C(a);a.showDifferences&&(V(a.edit,a.diff,n,DIFF_INSERT,a.classes),V(a.orig,a.diff,m,DIFF_DELETE,a.classes));"align"==a.mv.options.connect&&
P(a);B(a);null!=a.needsScrollSync&&D(a,a.needsScrollSync);I=!1}function g(b){I||(a.dealigned=!0,f(b))}function f(a){I||p||(clearTimeout(k),!0===a&&(p=!0),k=setTimeout(b,!0===a?20:250))}function h(b,d){a.diffOutOfDate||(a.diffOutOfDate=!0,n.from=n.to=m.from=m.to=0);g(d.text.length-1!=d.to.line-d.from.line)}function d(){a.diffOutOfDate=!0;a.dealigned=!0;b("full")}var k,n={from:0,to:0,marked:[]},m={from:0,to:0,marked:[]},p=!1;a.edit.on("change",h);a.orig.on("change",h);a.edit.on("swapDoc",d);a.orig.on("swapDoc",
d);"align"==a.mv.options.connect&&(q.on(a.edit.state.trackAlignable,"realign",g),q.on(a.orig.state.trackAlignable,"realign",g));return a.edit.on("viewportChange",function(){f(!1)}),a.orig.on("viewportChange",function(){f(!1)}),b(),b}(this);K(this,!0,!1);(b=this).edit.on("scroll",function(){D(b,!0)&&B(b)});b.orig.on("scroll",function(){D(b,!1)&&B(b);a&&D(a,!0)&&B(a)})},setShowDifferences:function(a){(a=!1!==a)!=this.showDifferences&&(this.showDifferences=a,this.forceUpdate("full"))}}),fa,J=q.MergeView=
function(a,b){function c(){p&&B(p);l&&B(l)}if(!(this instanceof J))return new J(a,b);var e,g,f=(this.options=b).origLeft,h=null==b.origRight?b.orig:b.origRight,d=null!=f,k=null!=h,n=1+(d?1:0)+(k?1:0),m=[],p=this.left=null,l=this.right=null,r=this,d=(d&&(p=this.left=new E(this,"left"),e=w("div",null,"CodeMirror-merge-pane CodeMirror-merge-left"),m.push(e),m.push(da(p))),w("div",null,"CodeMirror-merge-pane CodeMirror-merge-editor")),A=(m.push(d),k&&(l=this.right=new E(this,"right"),m.push(da(l)),g=
w("div",null,"CodeMirror-merge-pane CodeMirror-merge-right"),m.push(g)),(k?g:d).className+=" CodeMirror-merge-pane-rightmost",m.push(w("div",null,null,"height: 0; clear: both;")),this.wrap=a.appendChild(w("div",m,"CodeMirror-merge CodeMirror-merge-"+n+"pane"))),v=(this.edit=q(d,Q(b)),p&&p.init(e,f,b),l&&l.init(g,h,b),b.collapseIdentical&&this.editor().operation(function(){var a=b.collapseIdentical;"number"!=typeof a&&(a=2);for(var c=[],d=r.editor(),e=d.firstLine(),f=e,g=d.lastLine();f<=g;f++)c.push(!0);
r.left&&ga(r.left,a,e,c);r.right&&ga(r.right,a,e,c);for(f=0;f<c.length;f++)if(c[f]){for(var h,g=f+e,k=1;f<c.length-1&&c[f+1];f++,k++);a<k&&(h=[{line:g,cm:d}],r.left&&h.push({line:Z(g,r.left.chunks),cm:r.left.orig}),r.right&&h.push({line:Z(g,r.right.chunks),cm:r.right.orig}),h=function(a,b){function c(){for(var a=0;a<d.length;a++)d[a].clear()}for(var d=[],e=0;e<b.length;e++){var f=b[e],f=function(a,b,c){function d(){f.clear();a.removeLineClass(b,"wrap","CodeMirror-merge-collapsed-line")}a.addLineClass(b,
"wrap","CodeMirror-merge-collapsed-line");var e=document.createElement("span"),f=(e.className="CodeMirror-merge-collapsed-widget",e.title=a.phrase("Identical text collapsed. Click to expand."),a.markText(x(b,0),x(c-1),{inclusiveLeft:!0,inclusiveRight:!0,replacedWith:e,clearOnEnter:!0}));f.explicitlyCleared&&d();return q.on(e,"click",d),f.on("clear",d),q.on(e,"click",d),{mark:f,clear:d}}(f.cm,f.line,f.line+a);d.push(f);f.mark.on("clear",c)}return d[0].mark}(k,h),r.options.onCollapse)&&r.options.onCollapse(r,
g,k,h)}}),"align"==b.connect&&(this.aligners=[],P(this.left||this.right,!0)),p&&p.registerEvents(l),l&&l.registerEvents(p),q.on(window,"resize",c),setInterval(function(){for(var a=A.parentNode;a&&a!=document.body;a=a.parentNode);a||(clearInterval(v),q.off(window,"resize",c))},5E3))};J.prototype={constructor:J,editor:function(){return this.edit},rightOriginal:function(){return this.right&&this.right.orig},leftOriginal:function(){return this.left&&this.left.orig},setShowDifferences:function(a){this.right&&
this.right.setShowDifferences(a);this.left&&this.left.setShowDifferences(a)},rightChunks:function(){if(this.right)return C(this.right),this.right.chunks},leftChunks:function(){if(this.left)return C(this.left),this.left.chunks}};var ha=1,A=2,H=4;R.prototype={signal:function(){q.signal(this,"realign");this.height=this.cm.doc.height},set:function(a,b){for(var c=-1;c<this.alignable.length;c+=2){var e=this.alignable[c]-a;if(0==e)return(this.alignable[c+1]&b)==b?void 0:(this.alignable[c+1]|=b,void this.signal());
if(0<e)break}this.signal();this.alignable.splice(c,0,a,b)},find:function(a){for(var b=0;b<this.alignable.length;b+=2)if(this.alignable[b]==a)return b;return-1},check:function(a,b,c){var e=this.find(a);-1!=e&&this.alignable[e+1]&b&&(c.call(this,a)||(this.signal(),(c=this.alignable[e+1]&~b)?this.alignable[e+1]=c:this.alignable.splice(e,2)))},hasMarker:function(a){a=this.cm.getLineHandle(a);if(a.markedSpans)for(var b=0;b<a.markedSpans.length;b++)if(a.markedSpans[b].marker.collapsed&&null!=a.markedSpans[b].to)return!0;
return!1},hasWidget:function(a){a=this.cm.getLineHandle(a);if(a.widgets)for(var b=0;b<a.widgets.length;b++)if(!a.widgets[b].above&&!a.widgets[b].mergeSpacer)return!0;return!1},hasWidgetBelow:function(a){if(a!=this.cm.lastLine()&&(a=this.cm.getLineHandle(a+1),a.widgets))for(var b=0;b<a.widgets.length;b++)if(a.widgets[b].above&&!a.widgets[b].mergeSpacer)return!0;return!1},map:function(a,b,c){for(var e=c-b,g=a+b,f=-1,h=-1,d=0;d<this.alignable.length;d+=2){var k=this.alignable[d];k==a&&this.alignable[d+
1]&A&&(f=d);k==g&&this.alignable[d+1]&A&&(h=d);k<=a||(k<g?this.alignable.splice(d--,2):this.alignable[d]+=e)}-1<f&&((b=this.alignable[f+1])==A?this.alignable.splice(f,2):this.alignable[f+1]=b&~A);-1<h&&c&&this.set(a+c,A)}};q.commands.goNextDiff=function(a){return ia(a,1)};q.commands.goPrevDiff=function(a){return ia(a,-1)}});